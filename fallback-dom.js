import{querySel as e}from"./query-selector.js";var t,n,r,o,l,s;const i=Symbol("definedTag"),u=Symbol("customElements"),a=Symbol("document"),c=Symbol("tagName"),h=Symbol("reg"),d=Symbol("con"),p=Symbol("when");class CustomElementRegistry{constructor(){this[t]=new Map,this[n]=new Map,this[r]=new Map}define(e,t){const n=this[h];if(n.has(e))throw Error("element "+JSON.stringify(e)+" has already been defined");const r=t.prototype;let o=r;for(;o&&o!==Element.prototype;)o=Object.getPrototypeOf(o);if(!o)throw Error("the constructor of element "+JSON.stringify(e)+" is not a decendant of the right kind of Element class");const l=this[d];if(Element==t||l.has(t))throw Error("the prototype of element "+JSON.stringify(e)+" must be unique");n.set(e,t),l.set(t,e),r[c]=e;const s=this[p].get(e);if(s){this[p].delete(e);for(const e of s)e(t)}}upgrade(e){const t=this[h],n=e.tagName,r=t.get(n);if(!r)return;const o=Object.getPrototypeOf(e);if(o===Element.prototype)try{Object.setPrototypeOf(e,r.prototype),r.call(e)}catch(t){throw Object.setPrototypeOf(e,o),t}}whenDefined(e){const t=this[h].get(e);if(t)return Promise.resolve(t);let n=this[p].get(e);n||(n=[],this[p].set(e,n));const r=n;return new Promise((e=>r.push(e)))}get(e){return this[h].get(e)}[(t=h,n=d,r=p,i)](e){return this[d].get(e)}}const m=Symbol("parent"),g=Symbol("previousSibling"),b=Symbol("nextSibling");class Node{constructor(){if(this[o]=null,this[l]=null,this[s]=null,void 0===this[a])throw Error("a node must be created by a document")}get parentNode(){return this[m]}get previousSibling(){return this[g]}get nextSibling(){return this[b]}get ownerDocument(){return this[a]}cloneNode(e=!1){const t=9==this.nodeType&&this.constructor!=this.ownerDocument?.Element?new this.constructor:Object.create(Object.getPrototypeOf(this),{[a]:{value:this[a],writable:!0},[m]:{value:null,writable:!0},[g]:{value:null,writable:!0},[b]:{value:null,writable:!0}});{const e=this[w];void 0!==e&&Object.defineProperty(t,w,{value:e,writable:!0})}{const e=this[S];void 0!==e&&Object.defineProperty(t,S,{value:new Map(e),writable:!0})}{const e=this[c];t[c]||void 0===e||Object.defineProperty(t,c,{value:e,writable:!0})}{const e=this[v];t[v]||void 0===e||Object.defineProperty(t,v,{value:e,writable:!1})}if(10==this.nodeType){const e=this;Object.defineProperties(t,{name:{value:e.name,writable:!1},publicId:{value:e.publicId,writable:!1},systemId:{value:e.systemId,writable:!1}})}if(!e||!this[f])return t;const n=this;for(const e of n[f])t.insertBefore(e.cloneNode(!0),null);return t}unsafeSetParent(e){this[m]=e}unsafeReplaceParent(e){const t=this[m];t&&t.removeChild(this),this[m]=e}unsafeSetPrev(e){this[g]=e,e&&(e[b]=this)}unsafeSetNext(e){this[b]=e,e&&(e[g]=this)}}o=m,l=g,s=b;const f=Symbol("childNodes"),y=Symbol("children");class ParentNode extends Node{constructor(){super()}get textContent(){const e=this[f];return e?e.reduce(((e,t)=>{const n=t.nodeType;return 1==n||3==n||4==n?e+t.textContent:e}),""):""}set textContent(e){e=e.toString();const t=this[f]=[];this[y]=[],e&&t.push(this.ownerDocument.createTextNode(e))}hasChildNodes(){const e=this[f];return!!e&&0!=e.length}get childNodes(){const e=this[f];return e?e.slice():[]}get childElementCount(){const e=this[y];return e?e.length:0}get children(){const e=this[y];return e?e.slice():[]}get firstElementChild(){return this[y]?.[0]||null}get lastElementChild(){const e=this[y];if(!e)return null;const t=e?e.length:0;return t?e[t-1]:null}get firstChild(){return this[f]?.[0]||null}get lastChild(){const e=this[f];if(!e)return null;const t=e.length;return t?e[t-1]:null}append(...e){for(const t of e){const e="string"==typeof t?this.ownerDocument.createTextNode(t):"object"==typeof t&&t instanceof Node?t:void 0;if(void 0===e)throw new TypeError("unsupported input type");this.insertBefore(e,null)}}prepend(...e){let t=this[f];t||(t=[],this[f]=t);const n=t[0]||null;for(const t of e){const e="string"==typeof t?this.ownerDocument.createTextNode(t):"object"==typeof t&&t instanceof Node?t:void 0;if(void 0===e)throw new TypeError("unsupported input type");this.insertBefore(e,n)}}querySelector(t){return e(this,t).next().value||null}querySelectorAll(t){return Array.from(e(this,t))}replaceChildren(...e){let t=this[f];if(t){if(t.length){let e=this[y];e?e.length=0:(e=[],this[y]=e);const n=t.slice();t.length=0;for(const e of n)e.unsafeSetParent(null),e.unsafeSetPrev(null),e.unsafeSetNext(null)}}else t=[],this[f]=t;e.length&&this.append(...e)}insertBefore(e,t){if(e.ownerDocument!=this.ownerDocument){const t=this.nodeType;if(9!=t&&11!=t)throw Error("owner document mismatch");if(e.ownerDocument!=this){if(10!=e.nodeType||null!=e.ownerDocument)throw Error("owner document mismatch while inserting to the root");e[a]=this}}if(e.parentNode==this){if(t==e||t==e.nextSibling)return e;this.removeChild(e)}let n=this[f];n||(n=[],this[f]=n);let r=this[y];r||(r=[],this[y]=r);let o=n.length,l=r.length;if(t){if(o=n.indexOf(t),-1==o)throw Error("child does not exist");l=0;for(let e=o;e>=0;e--)if(1==n[e].nodeType){l=r.indexOf(n[e]);break}}if(e instanceof DocumentFragment){const t=e[f]?.slice();if(t&&t.length){for(const e of t)e.unsafeSetParent(this),1==e.nodeType&&r.splice(l++,0,e);t[0].unsafeSetPrev(n[o-1]||null),t[t.length-1].unsafeSetNext(n[o]||null),n.splice(o,0,...t),e[f].length=0,e[y]=[]}}else e.unsafeReplaceParent(this),e.unsafeSetPrev(n[o-1]||null),e.unsafeSetNext(n[o]||null),n.splice(o,0,e),1==e.nodeType&&r.splice(l++,0,e);return e}appendChild(e){return this.insertBefore(e,null)}removeChild(e){{const t=this[f],n=t?t.indexOf(e):-1;if(!t||-1==n)return e;if(t.splice(n,1),1!=e.nodeType)return e}{const t=this[y],n=t?t.indexOf(e):-1;return t&&-1!=n&&t.splice(n,1),e}}getElementsByClassName(e){return this.querySelectorAll("."+e)}getElementsByTagName(e){return this.querySelectorAll(e)}}const w=Symbol("textContent");class CharacterData extends Node{constructor(e){super(),this[w]=e.toString()}get data(){return this[w]}set data(e){this[w]=e.toString()}get length(){return this[w].length}appendData(e){this[w]+=e.toString()}}class Text extends CharacterData{get nodeType(){return 3}get textContent(){return this[w]}set textContent(e){this[w]=e.toString()}constructor(e){super(e)}}class CDATASection extends CharacterData{get nodeType(){return 4}get textContent(){return this[w]}set textContent(e){this[w]=e.toString()}constructor(e){super(e)}}const v=Symbol("target");class ProcessingInstruction extends CharacterData{constructor(e,t){super(t),this[v]=e}get nodeType(){return 7}get target(){return this[v]}get textContent(){return this[w]}set textContent(e){this[w]=e.toString()}}class Comment extends CharacterData{get nodeType(){return 8}get textContent(){return this[w]}set textContent(e){this[w]=e.toString()}constructor(e){super(e)}}class DocumentFragment extends ParentNode{get nodeType(){return 11}constructor(){super()}}class Attr extends Node{get specified(){return!0}get prefix(){const e=this.name.match(/^([^:]+):/);return e?e[1]:null}get localName(){return this.name.replace(/^[^:]+:/,"")}}const S=Symbol("attributes");class Element extends ParentNode{constructor(){if(super(),!this[c])throw Error("unexpected element without known tag name")}get nodeType(){return 1}get tagName(){return this[c]}get localName(){return this[c].replace(/^[^:]*:/,"")}get id(){return this.getAttribute("id")||""}set id(e){this.setAttribute("id",e)}get attributes(){const e=[],t=this[S];if(!t)return e;for(const[n,r]of t){const t=Object.create(Attr.prototype,{[a]:{value:this.ownerDocument,writable:!0},ownerElement:{value:this,writable:!0},name:{value:n,writable:!1},value:{value:r,writable:!0}});e.push(t)}return e}getAttribute(e){const t=this[S],n=t?t.get(e):null;return void 0===n?null:n}setAttribute(e,t){let n=this[S];n||(n=new Map,this[S]=n),n.set(e,t)}remove(){const e=this.parentNode;e&&e.removeChild(this)}}const x=Symbol("element");function C(e){var t,n;return e[x]=(n=class DOMElement extends Element{constructor(){super(),this[t]=e}},t=a,n),Object.defineProperties(e[x].prototype,{[a]:{value:e,writable:!0},[m]:{value:null,writable:!0},[g]:{value:null,writable:!0},[b]:{value:null,writable:!0}}),e}class Document extends ParentNode{constructor(){super()}get Element(){return this[x]}get customElements(){let e=this[u];return e||(this[u]=e=new CustomElementRegistry),e}get nodeType(){return 9}get documentElement(){return this.firstElementChild}createElement(e){const t=this[u]?.get(e);return t?new t:Object.create(this[x].prototype,{[c]:{value:e,writable:!1}})}createTextNode(e){return Object.create(Text.prototype,{[a]:{value:this,writable:!0},[m]:{value:null,writable:!0},[g]:{value:null,writable:!0},[b]:{value:null,writable:!0},[w]:{value:e.toString(),writable:!0}})}createComment(e){return Object.create(Comment.prototype,{[a]:{value:this,writable:!0},[m]:{value:null,writable:!0},[g]:{value:null,writable:!0},[b]:{value:null,writable:!0},[w]:{value:e.toString(),writable:!0}})}createCDATASection(e){return Object.create(CDATASection.prototype,{[a]:{value:this,writable:!0},[m]:{value:null,writable:!0},[g]:{value:null,writable:!0},[b]:{value:null,writable:!0},[w]:{value:e.toString(),writable:!0}})}createProcessingInstruction(e,t){return Object.create(ProcessingInstruction.prototype,{[a]:{value:this,writable:!0},[m]:{value:null,writable:!0},[g]:{value:null,writable:!0},[b]:{value:null,writable:!0},[v]:{value:e.toString(),writable:!0},[w]:{value:t.toString(),writable:!0}})}createDocumentFragment(){return Object.create(DocumentFragment.prototype,{[a]:{value:this,writable:!0},[m]:{value:null,writable:!1},[g]:{value:null,writable:!1},[b]:{value:null,writable:!1}})}getElementById(e){return this.querySelector("#"+e)}}function E(){return C(Object.create(class DOMDocument extends Document{constructor(){super()}}.prototype,{[a]:{value:null}}))}function N(e=""){const t=Object.create(class HTMLDocument extends Document{get body(){for(const e of this.documentElement.children)if("body"==e.localName)return e;return null}get head(){for(const e of this.documentElement.children)if("head"==e.localName)return e;return null}constructor(){super()}}.prototype);t[a]=null,C(t),Object.defineProperty(t.Element.prototype,"className",{get(){return this.getAttribute("class")||""},set(e){this.setAttribute("class",e.trim())}});{t.appendChild(D("html"));const n=t.createElement("html");n.appendChild(t.createElement("head")).appendChild(t.createElement("title")).textContent=e,n.appendChild(t.createElement("body")),t.appendChild(n)}return t}class DocumentType extends Node{constructor(){throw super(),Error("Constructor should never be called")}get nodeType(){return 10}get internalSubset(){return null}set textContent(e){}get textContent(){return null}}function D(e,t="",n=""){return Object.create(DocumentType.prototype,{[a]:{value:null,writable:!0},name:{value:e,writable:!1},publicId:{value:t,writable:!1},systemId:{value:n,writable:!1},[m]:{value:null,writable:!0},[g]:{value:null,writable:!0},[b]:{value:null,writable:!0}})}export{CDATASection,CharacterData,Comment,Document,DocumentFragment,DocumentType,Element,Node,ProcessingInstruction,Text,E as createDocument,D as createDocumentType,N as createHTMLDocument};
//# sourceMappingURL=fallback-dom.js.map

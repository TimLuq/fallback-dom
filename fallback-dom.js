import{querySel as t}from"./query-selector.js";var e,r,n,s,o,i;const l=Symbol("definedTag"),u=Symbol("customElements"),a=Symbol("document"),c=Symbol("tagName"),h=Symbol("reg"),d=Symbol("con"),p=Symbol("when");class CustomElementRegistry{constructor(){this[e]=new Map,this[r]=new Map,this[n]=new Map}define(t,e){const r=this[h];if(r.has(t))throw Error("element "+JSON.stringify(t)+" has already been defined");const n=e.prototype;let s=n;for(;s&&s!==Element.prototype;)s=Object.getPrototypeOf(s);if(!s)throw Error("the constructor of element "+JSON.stringify(t)+" is not a decendant of the right kind of Element class");const o=this[d];if(Element==e||o.has(e))throw Error("the prototype of element "+JSON.stringify(t)+" must be unique");r.set(t,e),o.set(e,t),n[c]=t;const i=this[p].get(t);if(i){this[p].delete(t);for(const t of i)t(e)}}upgrade(t){const e=this[h],r=t.tagName,n=e.get(r);if(!n)return;const s=Object.getPrototypeOf(t);if(s===Element.prototype)try{Object.setPrototypeOf(t,n.prototype),n.call(t)}catch(e){throw Object.setPrototypeOf(t,s),e}}whenDefined(t){const e=this[h].get(t);if(e)return Promise.resolve(e);let r=this[p].get(t);r||(r=[],this[p].set(t,r));const n=r;return new Promise((t=>n.push(t)))}get(t){return this[h].get(t)}[(e=h,r=d,n=p,l)](t){return this[d].get(t)}}class DOMTokenList{constructor(t,e,r,n){this._d=new Set,this._split=t,this._accessor=r,this._setter=n,this._comb=e}_upd(){const t=this._accessor(),e=this._d;if(t==this._lastRead)return e;if(this._lastRead=t,e.clear(),!t)return e;for(const r of t.split(this._split))r&&e.add(r);return e}get length(){return this._upd().size}get value(){return this._upd(),this._lastRead||""}set value(t){this._upd(),this._setter(t||"")}toString(){return this._upd(),this._lastRead||""}add(...t){const e=this._upd(),r=this._split;for(const n of t)if(n){if(r.test(n))throw Error("invalid token");e.add(n)}this._setter(Array.from(e).join(this._comb))}contains(t){return this._upd().has(t)}remove(...t){const e=this._upd(),r=this._split;for(const n of t)if(n){if(r.test(n))throw Error("invalid token");e.delete(n)}this._setter(Array.from(e).join(this._comb))}replace(t,e){const r=this._upd();if(!r.delete(t))return!1;if(this._split.test(e))throw Error("invalid token");return r.add(e),this._setter(Array.from(r).join(this._comb)),!0}toggle(t,e){const r=this._upd();if(!e&&(r.delete(t)||!1===e))return!1;if(this._split.test(t))throw Error("invalid token");return r.add(t),this._setter(Array.from(r).join(this._comb)),!0}forEach(t,e){this._upd().forEach((r=>t.call(e,r,-1,this)))}}const m=Symbol("parent"),f=Symbol("previousSibling"),g=Symbol("nextSibling");class Node{constructor(){if(this[s]=null,this[o]=null,this[i]=null,void 0===this[a])throw Error("a node must be created by a document")}get parentNode(){return this[m]}get previousSibling(){return this[f]}get nextSibling(){return this[g]}get ownerDocument(){return this[a]}cloneNode(t=!1){const e=9==this.nodeType&&this.constructor!=this.ownerDocument?.Element?new this.constructor:Object.create(Object.getPrototypeOf(this),{[a]:{value:this[a],writable:!0},[m]:{value:null,writable:!0},[f]:{value:null,writable:!0},[g]:{value:null,writable:!0}});{const t=this[y];void 0!==t&&Object.defineProperty(e,y,{value:t,writable:!0})}{const t=this[S];void 0!==t&&Object.defineProperty(e,S,{value:new Map(t),writable:!0})}{const t=this[c];e[c]||void 0===t||Object.defineProperty(e,c,{value:t,writable:!0})}{const t=this[v];e[v]||void 0===t||Object.defineProperty(e,v,{value:t,writable:!1})}if(10==this.nodeType){const t=this;Object.defineProperties(e,{name:{value:t.name,writable:!1},publicId:{value:t.publicId,writable:!1},systemId:{value:t.systemId,writable:!1}})}if(!t||!this[b])return e;const r=this;for(const t of r[b])e.insertBefore(t.cloneNode(!0),null);return e}unsafeSetParent(t){this[m]=t}unsafeReplaceParent(t){const e=this[m];e&&e.removeChild(this),this[m]=t}unsafeSetPrev(t){this[f]=t,t&&(t[g]=this)}unsafeSetNext(t){this[g]=t,t&&(t[f]=this)}}s=m,o=f,i=g;const b=Symbol("childNodes"),w=Symbol("children");class ParentNode extends Node{constructor(){super()}get textContent(){const t=this[b];return t?t.reduce(((t,e)=>{const r=e.nodeType;return 1==r||3==r||4==r?t+e.textContent:t}),""):""}set textContent(t){t=t.toString();const e=this[b]=[];this[w]=[],t&&e.push(this.ownerDocument.createTextNode(t))}hasChildNodes(){const t=this[b];return!!t&&0!=t.length}get childNodes(){const t=this[b];return t?t.slice():[]}get childElementCount(){const t=this[w];return t?t.length:0}get children(){const t=this[w];return t?t.slice():[]}get firstElementChild(){return this[w]?.[0]||null}get lastElementChild(){const t=this[w];if(!t)return null;const e=t?t.length:0;return e?t[e-1]:null}get firstChild(){return this[b]?.[0]||null}get lastChild(){const t=this[b];if(!t)return null;const e=t.length;return e?t[e-1]:null}append(...t){for(const e of t){const t="string"==typeof e?this.ownerDocument.createTextNode(e):"object"==typeof e&&e instanceof Node?e:void 0;if(void 0===t)throw new TypeError("unsupported input type");this.insertBefore(t,null)}}prepend(...t){let e=this[b];e||(e=[],this[b]=e);const r=e[0]||null;for(const e of t){const t="string"==typeof e?this.ownerDocument.createTextNode(e):"object"==typeof e&&e instanceof Node?e:void 0;if(void 0===t)throw new TypeError("unsupported input type");this.insertBefore(t,r)}}querySelector(e){return t(this,e).next().value||null}querySelectorAll(e){return Array.from(t(this,e))}replaceChildren(...t){let e=this[b];if(e){if(e.length){let t=this[w];t?t.length=0:(t=[],this[w]=t);const r=e.slice();e.length=0;for(const t of r)t.unsafeSetParent(null),t.unsafeSetPrev(null),t.unsafeSetNext(null)}}else e=[],this[b]=e;t.length&&this.append(...t)}replaceChild(t,e){return this.insertBefore(t,e),this.removeChild(e)}insertBefore(t,e){if(t.ownerDocument!=this.ownerDocument){const e=this.nodeType;if(9!=e&&11!=e)throw Error("owner document mismatch");if(t.ownerDocument!=this){if(10!=t.nodeType||null!=t.ownerDocument)throw Error("owner document mismatch while inserting to the root");t[a]=this}}{let e=this;for(;e&&e!=t;)e=e.parentNode;if(e)throw Error("node insertion would lead to circularity")}if(t.parentNode==this){if(e==t||e==t.nextSibling)return t;this.removeChild(t)}let r=this[b];r||(r=[],this[b]=r);let n=this[w];n||(n=[],this[w]=n);let s=r.length,o=n.length;if(e){if(s=r.indexOf(e),-1==s)throw Error("child does not exist");o=0;for(let t=s;t>=0;t--)if(1==r[t].nodeType){o=n.indexOf(r[t]);break}}if(t instanceof DocumentFragment){const e=t[b]?.slice();if(e&&e.length){for(const t of e)t.unsafeSetParent(this),1==t.nodeType&&n.splice(o++,0,t);e[0].unsafeSetPrev(r[s-1]||null),e[e.length-1].unsafeSetNext(r[s]||null),r.splice(s,0,...e),t[b].length=0,t[w]=[]}}else t.unsafeReplaceParent(this),t.unsafeSetPrev(r[s-1]||null),t.unsafeSetNext(r[s]||null),r.splice(s,0,t),1==t.nodeType&&n.splice(o++,0,t);return t}appendChild(t){return this.insertBefore(t,null)}removeChild(t){{const e=this[b],r=e?e.indexOf(t):-1;if(!e||-1==r)return t;if(e.splice(r,1),1!=t.nodeType)return t}{const e=this[w],r=e?e.indexOf(t):-1;return e&&-1!=r&&e.splice(r,1),t}}getElementsByClassName(t){return this.querySelectorAll("."+t)}getElementsByTagName(t){return this.querySelectorAll(t)}}const y=Symbol("textContent");class CharacterData extends Node{constructor(t){super(),this[y]=t.toString()}get data(){return this[y]}set data(t){this[y]=t.toString()}get length(){return this[y].length}appendData(t){this[y]+=t.toString()}}class Text extends CharacterData{get nodeType(){return 3}get textContent(){return this[y]}set textContent(t){this[y]=t.toString()}constructor(t){super(t)}}class CDATASection extends CharacterData{get nodeType(){return 4}get textContent(){return this[y]}set textContent(t){this[y]=t.toString()}constructor(t){super(t)}}const v=Symbol("target");class ProcessingInstruction extends CharacterData{constructor(t,e){super(e),this[v]=t}get nodeType(){return 7}get target(){return this[v]}get textContent(){return this[y]}set textContent(t){this[y]=t.toString()}}class Comment extends CharacterData{get nodeType(){return 8}get textContent(){return this[y]}set textContent(t){this[y]=t.toString()}constructor(t){super(t)}}class DocumentFragment extends ParentNode{get nodeType(){return 11}constructor(){super()}}class Attr extends Node{get specified(){return!0}get prefix(){const t=this.name.match(/^([^:]+):/);return t?t[1]:null}get localName(){return this.name.replace(/^[^:]+:/,"")}}const S=Symbol("attributes"),C=Symbol("classList");class Element extends ParentNode{constructor(){if(super(),!this[c])throw Error("unexpected element without known tag name")}get nodeType(){return 1}get tagName(){return this[c]}get localName(){return this[c].replace(/^[^:]*:/,"")}get id(){return this.getAttribute("id")||""}set id(t){this.setAttribute("id",t)}get classList(){let t=this[C];return t||(t=new DOMTokenList(/\s+/g," ",(()=>this.getAttribute("class")),(t=>this.setAttribute("class",t))),this[C]=t),t}get attributes(){const t=[],e=this[S];if(!e)return t;for(const[r,n]of e){const e=Object.create(Attr.prototype,{[a]:{value:this.ownerDocument,writable:!0},ownerElement:{value:this,writable:!0},name:{value:r,writable:!1},value:{value:n,writable:!0}});t.push(e)}return t}getAttribute(t){const e=this[S],r=e?e.get(t):null;return void 0===r?null:r}setAttribute(t,e){let r=this[S];r||(r=new Map,this[S]=r),r.set(t,e)}remove(){const t=this.parentNode;t&&t.removeChild(this)}}const x=Symbol("element");function E(t){var e,r;return t[x]=(r=class DOMElement extends Element{constructor(){super(),this[e]=t}},e=a,r),Object.defineProperties(t[x].prototype,{[a]:{value:t,writable:!0},[m]:{value:null,writable:!0},[f]:{value:null,writable:!0},[g]:{value:null,writable:!0}}),t}class Document extends ParentNode{constructor(){super()}get Element(){return this[x]}get customElements(){let t=this[u];return t||(this[u]=t=new CustomElementRegistry),t}get nodeType(){return 9}get documentElement(){return this.firstElementChild}createElement(t){const e=this[u]?.get(t);return e?new e:Object.create(this[x].prototype,{[c]:{value:t,writable:!1}})}createTextNode(t){return Object.create(Text.prototype,{[a]:{value:this,writable:!0},[m]:{value:null,writable:!0},[f]:{value:null,writable:!0},[g]:{value:null,writable:!0},[y]:{value:t.toString(),writable:!0}})}createComment(t){return Object.create(Comment.prototype,{[a]:{value:this,writable:!0},[m]:{value:null,writable:!0},[f]:{value:null,writable:!0},[g]:{value:null,writable:!0},[y]:{value:t.toString(),writable:!0}})}createCDATASection(t){return Object.create(CDATASection.prototype,{[a]:{value:this,writable:!0},[m]:{value:null,writable:!0},[f]:{value:null,writable:!0},[g]:{value:null,writable:!0},[y]:{value:t.toString(),writable:!0}})}createProcessingInstruction(t,e){return Object.create(ProcessingInstruction.prototype,{[a]:{value:this,writable:!0},[m]:{value:null,writable:!0},[f]:{value:null,writable:!0},[g]:{value:null,writable:!0},[v]:{value:t.toString(),writable:!0},[y]:{value:e.toString(),writable:!0}})}createDocumentFragment(){return Object.create(DocumentFragment.prototype,{[a]:{value:this,writable:!0},[m]:{value:null,writable:!1},[f]:{value:null,writable:!1},[g]:{value:null,writable:!1}})}getElementById(t){return this.querySelector("#"+t)}}function N(){return E(Object.create(class DOMDocument extends Document{constructor(){super()}}.prototype,{[a]:{value:null}}))}function D(t=""){const e=Object.create(class HTMLDocument extends Document{get body(){for(const t of this.documentElement.children)if("body"==t.localName)return t;return null}get head(){for(const t of this.documentElement.children)if("head"==t.localName)return t;return null}constructor(){super()}}.prototype);e[a]=null,E(e),Object.defineProperty(e.Element.prototype,"className",{get(){return this.getAttribute("class")||""},set(t){this.setAttribute("class",t.trim())}});{e.appendChild(O("html"));const r=e.createElement("html");r.appendChild(e.createElement("head")).appendChild(e.createElement("title")).textContent=t,r.appendChild(e.createElement("body")),e.appendChild(r)}return e}class DocumentType extends Node{constructor(){throw super(),Error("Constructor should never be called")}get nodeType(){return 10}get internalSubset(){return null}set textContent(t){}get textContent(){return null}}function O(t,e="",r=""){return Object.create(DocumentType.prototype,{[a]:{value:null,writable:!0},name:{value:t,writable:!1},publicId:{value:e,writable:!1},systemId:{value:r,writable:!1},[m]:{value:null,writable:!0},[f]:{value:null,writable:!0},[g]:{value:null,writable:!0}})}export{CDATASection,CharacterData,Comment,Document,DocumentFragment,DocumentType,Element,Node,ProcessingInstruction,Text,N as createDocument,O as createDocumentType,D as createHTMLDocument};
//# sourceMappingURL=fallback-dom.js.map
